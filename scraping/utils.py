# -*- coding: utf-8 -*-

from bs4 import BeautifulSoup, Comment

import unicodedata

def scrape_ledger(ledger_html):
    """
    Scrapes the governmental ledger (statsliggare) HTML and returns a
    dictionary containing the appropriation direction (regleringsbrev) URL:s
    and agency name for each appropriation direction.

    Args:
        ledger_html (str): The HTML content of the ledger page.
    
    Returns:
        dict: A dictionary of the URL:s to the appropriation directions as keys
        and the agency name as value.
    """
    soup = BeautifulSoup(ledger_html, 'html.parser')
    app_dir_urls = {}

    for item in soup.find(id='Myndigheter').find_all('a'):
        app_dir_urls[item.get('href')] = item.string

    return app_dir_urls

def scrape_app_dir(app_dir_html):
    """
    Scrapes a governmental appropriation direction (regleringsbrev) HTML and
    returns a dictionary of with a few selected sections and their HTML
    content.

    Args:
        app_dir_html (str): The HTML content of a appropriation direction page.

    Returns:
        dict: A dictionary of a few selected sections in the appropriation
        direction.
    """
    soup = BeautifulSoup(app_dir_html, 'html.parser')
    data = {}

    def get_sanitized_parent(comment):
        comment_elem = soup.find_all(string=lambda s: isinstance(s, Comment) and comment in s)[0]
        return unicodedata.normalize("NFKD", str(comment_elem.parent))

    data['goals_and_reporting'] = get_sanitized_parent("BEGIN output av maalAaterrapportering")
    data['objective'] = get_sanitized_parent("BEGIN output av uppdrag")

    return data

AGENCY_ORG_NUMBER = {
    "AFFÄRSVERKET SVENSKA KRAFTNÄT": "202100-4284",
    "ALKOHOLSORTIMENTSNÄMNDEN": "202100-5943",
    "ALLMÄNNA REKLAMATIONSNÄMNDEN": "202100-3625",
    "ARBETSDOMSTOLEN": "202100-2122",
    "ARBETSFÖRMEDLINGEN": "202100-2114",
    "ARBETSGIVARVERKET": "202100-3476",
    "ARBETSMILJÖVERKET": "202100-2148",
    "AVVECKLINGSMYNDIGHETEN FÖR NÄTVERK OCH SAMARBETE INOM HÖGRE UTBILDNING": "202100-5323",
    "AVVECKLINGSMYNDIGHETEN FÖR SKOLMYNDIGHETER M.M.": "202100-5794",
    "AVVECKLINGSMYNDIGHETEN FÖR SRV, KBM OCH SPF": "202100-5968",
    "BANVERKET": "202100-4003",
    "BARNOMBUDSMANNEN": "202100-3690",
    "BLEKINGE TEKNISKA HÖGSKOLA": "202100-4011",
    "BOKFÖRINGSNÄMNDEN": "202100-3278",
    "BOLAGSVERKET": "202100-5489",
    "BOVERKET": "202100-3989",
    "BROTTSFÖREBYGGANDE RÅDET": "202100-0068",
    "BROTTSOFFERMYNDIGHETEN": "202100-3435",
    "CENTRALA STUDIESTÖDSNÄMNDEN": "202100-1819",
    "DATAINSPEKTIONEN": "202100-0050",
    "DELEGATIONEN MOT SEGREGATION": "202100-6701",
    "DISKRIMINERINGSOMBUDSMANNEN": "202100-6073",
    "DOMARNÄMNDEN": "202100-6081",
    "E-HÄLSOMYNDIGHETEN": "202100-6552",
    "EKOBROTTSMYNDIGHETEN": "202100-4979",
    "EKONOMISTYRNINGSVERKET": "202100-5026",
    "ELSÄKERHETSVERKET": "202100-4466",
    "ENERGIMARKNADSINSPEKTIONEN": "202100-5695",
    "ETIKPRÖVNINGSMYNDIGHETEN": "202100-6925",
    "EXPORTKREDITNÄMNDEN": "202100-2098",
    "FASTIGHETSMÄKLARINSPEKTIONEN": "202100-4870",
    "FINANSINSPEKTIONEN": "202100-4235",
    "FINANSPOLITISKA RÅDET": "202100-5687",
    "FISKERIVERKET": "202100-1843",
    "FOLKE BERNADOTTEAKADEMIN": "202100-5380",
    "FOLKHÄLSOMYNDIGHETEN": "202100-6545",
    "FORSKNINGSRÅDET FÖR HÄLSA, ARBETSLIV OCH VÄLFÄRD": "202100-5240",
    "FORSKNINGSRÅDET FÖR MILJÖ, AREELLA NÄRINGAR OCH SAMHÄLLSBYGGANDE": "202100-5232",
    "FORTIFIKATIONSVERKET": "202100-4607",
    "FORUM FÖR LEVANDE HISTORIA": "202100-5356",
    "FÖRSVARETS MATERIELVERK": "202100-0340",
    "FÖRSVARETS RADIOANSTALT": "202100-0365",
    "FÖRSVARSEXPORTMYNDIGHETEN": "202100-6339",
    "FÖRSVARSHÖGSKOLAN": "202100-4730",
    "FÖRSVARSMAKTEN": "202100-4615",
    "FÖRSVARSUNDERRÄTTELSEDOMSTOLEN": "202100-6313",
    "FÖRSÄKRINGSKASSAN": "202100-5521",
    "GENTEKNIKNÄMNDEN": "202100-4813",
    "GRANSKNINGSNÄMNDEN FÖR RADIO OCH TV": "202100-4714",
    "GYMNASTIK- OCH IDROTTSHÖGSKOLAN": "202100-4334",
    "GÖTEBORGS UNIVERSITET": "202100-3153",
    "HAVS- OCH VATTENMYNDIGHETEN": "202100-6420",
    "HÄLSO- OCH SJUKVÅRDENS ANSVARSNÄMND": "202100-3765",
    "HÖGSKOLAN DALARNA": "202100-2908",
    "HÖGSKOLAN I BORÅS": "202100-3138",
    "HÖGSKOLAN I GÄVLE": "202100-2890",
    "HÖGSKOLAN I HALMSTAD": " 202100-3203",
    "HÖGSKOLAN I SKÖVDE": "202100-3146",
    "HÖGSKOLAN KRISTIANSTAD": "202100-3195",
    "HÖGSKOLAN VÄST": "202100-4052",
    "INSPEKTIONEN FÖR ARBETSLÖSHETSFÖRSÄKRINGEN": "202100-5414",
    "INSPEKTIONEN FÖR SOCIALFÖRSÄKRINGEN": "202100-6248",
    "INSPEKTIONEN FÖR STRATEGISKA PRODUKTER": "202100-4912",
    "INSPEKTIONEN FÖR VÅRD OCH OMSORG": "202100-6537",
    "INSTITUTET FÖR ARBETSMARKNADS- OCH UTBILDNINGSPOLITISK UTVÄRDERING": "202100-4946",
    "INSTITUTET FÖR RYMDFYSIK": "202100-3567",
    "INSTITUTET FÖR SPRÅK OCH FOLKMINNEN": "202100-1082",
    "INSTITUTET FÖR UTVÄRDERING AV INTERNATIONELLT UTVECKLINGSSAMARBETE": "202100-5604",
    "INTERNATIONELLA PROGRAMKONTORET FÖR UTBILDNINGSOMRÅDET": "202100-4854",
    "JUSTITIEKANSLERN": "202100-0035",
    "JÄMSTÄLLDHETSMYNDIGHETEN": "202100-6693",
    "JÄMSTÄLLDHETSOMBUDSMANNEN": "202100-3617",
    "JÄRNVÄGSSTYRELSEN": "202100-5505",
    "KAMMARKOLLEGIET": "202100-0829",
    "KARLSTADS UNIVERSITET": "202100-3120",
    "KAROLINSKA INSTITUTET": "202100-2973",
    "KEMIKALIEINSPEKTIONEN": "202100-3880",
    "KOMMERSKOLLEGIUM": "202100-2007",
    "KONJUNKTURINSTITUTET": "202100-0845",
    "KONKURRENSVERKET": "202100-4342",
    "KONSTFACK": "202100-1199",
    "KONSTNÄRSNÄMNDEN": "202100-3252",
    "KONSUMENTVERKET": "202100-2064",
    "KRIMINALVÅRDEN": "202100-0225",
    "KRISBEREDSKAPSMYNDIGHETEN": "202100-5349",
    "KRONOFOGDEMYNDIGHETEN": "202100-5646",
    "KUNGL. BIBLIOTEKET": "202100-1710",
    "KUNGLIGA HOV- OCH SLOTTSSTATEN": "202100-3484",
    "KUNGL. KONSTHÖGSKOLAN": "202100-2957",
    "KUNGL. MUSIKHÖGSKOLAN I STOCKHOLM": "202100-1215",
    "KUNGL. TEKNISKA HÖGSKOLAN": "202100-3054",
    "KUSTBEVAKNINGEN": "202100-3997",
    "LANTMÄTERIET": "202100-4888",
    "LINKÖPINGS UNIVERSITET": "202100-3096",
    "LINNÉUNIVERSITETET": "202100-6271",
    "LIVRUSTKAMMAREN OCH SKOKLOSTERS SLOTT MED STIFTELSEN HALLWYLSKA MUSEET": "202100-3732",
    "LIVSMEDELSVERKET": "202100-1850",
    "LUFTFARTSSTYRELSEN": "202100-5547",
    "LUFTFARTSVERKET": "202100-0795",
    "LULEÅ TEKNISKA UNIVERSITET": "202100-2841",
    "LUNDS UNIVERSITET": "202100-3211",
    "LÄKEMEDELSVERKET": "202100-4078",
    "LÄNSSTYRELSEN I BLEKINGE LÄN": "202100-2320",
    "LÄNSSTYRELSEN I DALARNAS LÄN": "202100-2429",
    "LÄNSSTYRELSEN I GOTLANDS LÄN": "202100-2312",
    "LÄNSSTYRELSEN I GÄVLEBORGS LÄN": "202100-2437",
    "LÄNSSTYRELSEN I HALLANDS LÄN": "202100-2353",
    "LÄNSSTYRELSEN I JÄMTLANDS LÄN": "202100-2452",
    "LÄNSSTYRELSEN I JÖNKÖPINGS LÄN": "202100-2288",
    "LÄNSSTYRELSEN I KALMAR LÄN": "202100-2304",
    "LÄNSSTYRELSEN I KRONOBERGS LÄN": "202100-2296",
    "LÄNSSTYRELSEN I NORRBOTTENS LÄN": "202100-2478",
    "LÄNSSTYRELSEN I SKÅNE LÄN": "202100-2346",
    "LÄNSSTYRELSEN I STOCKHOLMS LÄN": "202100-2247",
    "LÄNSSTYRELSEN I SÖDERMANLANDS LÄN": "202100-2262",
    "LÄNSSTYRELSEN I UPPSALA LÄN": "202100-2254",
    "LÄNSSTYRELSEN I VÄRMLANDS LÄN": "202100-2395",
    "LÄNSSTYRELSEN I VÄSTERBOTTENS LÄN": "202100-2460",
    "LÄNSSTYRELSEN I VÄSTERNORRLANDS LÄN": "202100-2445",
    "LÄNSSTYRELSEN I VÄSTMANLANDS LÄN": "202100-2411",
    "LÄNSSTYRELSEN I VÄSTRA GÖTALANDS LÄN": "202100-2361",
    "LÄNSSTYRELSEN I ÖREBRO LÄN": "202100-2403",
    "LÄNSSTYRELSEN I ÖSTERGÖTLANDS LÄN": "202100-2270",
    "MALMÖ UNIVERSITET": "202100-4920",
    "MARKNADSDOMSTOLEN": "202100-2015",
    "MEDLINGSINSTITUTET": "202100-5174",
    "MIGRATIONSVERKET": "202100-2163",
    "MITTUNIVERSITETET": "202100-4524",
    "MODERNA MUSEET": "202100-5091",
    "MYNDIGHETEN FÖR ARBETSMILJÖKUNSKAP": "202100-6875",
    "MYNDIGHETEN FÖR DELAKTIGHET": "202100-5588",
    "MYNDIGHETEN FÖR DIGITAL FÖRVALTNING": "202100-6883",
    "MYNDIGHETEN FÖR FAMILJERÄTT OCH FÖRÄLDRASKAPSSTÖD": "202100-4169",
    "MYNDIGHETEN FÖR KULTURANALYS": "202100-6404",
    "MYNDIGHETEN FÖR PRESS, RADIO OCH TV": "202100-6347",
    "MYNDIGHETEN FÖR SAMHÄLLSSKYDD OCH BEREDSKAP": "202100-5984",
    "MYNDIGHETEN FÖR STÖD TILL TROSSAMFUND": "202100-5141",
    "MYNDIGHETEN FÖR TILLGÄNGLIGA MEDIER": "202100-3591",
    "MYNDIGHETEN FÖR TILLVÄXTPOLITISKA UTVÄRDERINGAR OCH ANALYSER": "202100-6164",
    "MYNDIGHETEN FÖR UNGDOMS- OCH CIVILSAMHÄLLESFRÅGOR": "202100-1173",
    "MYNDIGHETEN FÖR VÅRD- OCH OMSORGSANALYS": "202100-6412",
    "MYNDIGHETEN FÖR YRKESHÖGSKOLAN": "202100-6230",
    "MÄLARDALENS HÖGSKOLA": "202100-2916",
    "NATIONALMUSEUM": "202100-1108",
    "NATIONELLT CENTRUM FÖR FLEXIBELT LÄRANDE": "202100-5307",
    "NATURHISTORISKA RIKSMUSEET": "202100-1124",
    "NATURVÅRDSVERKET": "202100-1975",
    "NORDISKA AFRIKAINSTITUTET": "202100-2726",
    "NÄMNDEN FÖR HEMSLÖJDSFRÅGOR": "202100-4144",
    "NÄMNDEN FÖR PRÖVNING AV OREDLIGHET I FORSKNING": "202100-6933",
    "OMBUDSMANNEN MOT DISKRIMINERING PÅ GRUND AV SEXUELL LÄGGNING": "202100-5083",
    "OPERAHÖGSKOLAN I STOCKHOLM": "202100-2965",
    "PATENT- OCH REGISTRERINGSVERKET": "202100-2072",
    "PATENTOMBUDSNÄMNDEN": "202100-6370",
    "PENSIONSMYNDIGHETEN": "202100-6255",
    "POLARFORSKNINGSSEKRETARIATET": "202100-4060",
    "POLISMYNDIGHETEN": "202100-0076",
    "POST- OCH TELESTYRELSEN": "202100-4359",
    "PREMIEPENSIONSMYNDIGHETEN": "202100-5034",
    "PRESSTÖDSNÄMNDEN": "202100-3294",
    "RADIO- OCH TV-VERKET": "202100-4680",
    "REGERINGSKANSLIET": "202100-3831",
    "REGIONALA ETIKPRÖVNINGSNÄMNDEN I GÖTEBORG": "202200-1545",
    "REGIONALA ETIKPRÖVNINGSNÄMNDEN I LINKÖPING": "202200-1552",
    "REGIONALA ETIKPRÖVNINGSNÄMNDEN I STOCKHOLM": "202200-1578",
    "REGIONALA ETIKPRÖVNINGSNÄMNDEN I UMEÅ": "202200-1586",
    "REGIONALA ETIKPRÖVNINGSNÄMNDEN I UPPSALA": "202200-1594",
    "REVISORSINSPEKTIONEN": "202100-4805",
    "RIKSANTIKVARIEÄMBETET": "202100-1090",
    "RIKSARKIVET": "202100-1074",
    "RIKSGÄLDSKONTORET": "202100-2635",
    "RIKSTRAFIKEN": "202100-5059",
    "RIKSUTSTÄLLNINGAR": "202100-4995",
    "RYMDSTYRELSEN": "202100-2585",
    "RÅDET FÖR EUROPEISKA SOCIALFONDEN I SVERIGE": "202100-5224",
    "RÄTTSMEDICINALVERKET": "202100-4227",
    "SAMESKOLSTYRELSEN": "202100-4631",
    "SAMETINGET": "202100-4573",
    "SJÖFARTSVERKET": "202100-0654",
    "SKATTEVERKET": "202100-5448",
    "SKOGSSTYRELSEN": "202100-5612",
    "SKOLFORSKNINGSINSTITUTET": "202100-6602",
    "SMITTSKYDDSINSTITUTET": "202100-4532",
    "SOCIALSTYRELSEN": "202100-0555",
    "SPECIALPEDAGOGISKA SKOLMYNDIGHETEN": "202100-5745",
    "SPELINSPEKTIONEN": "202100-3310",
    "STATENS BEREDNING FÖR MEDICINSK OCH SOCIAL UTVÄRDERING": "202100-4417",
    "STATENS CENTRUM FÖR ARKITEKTUR OCH DESIGN": "202100-3427",
    "STATENS ENERGIMYNDIGHET": "202100-5000",
    "STATENS FASTIGHETSVERK": "202100-4474",
    "STATENS FÖRSVARSHISTORISKA MUSEER": "202100-0464",
    "STATENS GEOTEKNISKA INSTITUT": "202100-0712",
    "STATENS HAVERIKOMMISSION": "202100-3260",
    "STATENS HISTORISKA MUSEER": "202100-4953",
    "STATENS INSPEKTION FÖR FÖRSVARSUNDERRÄTTELSEVERKSAMHETEN": "202100-6214",
    "STATENS INSTITUTIONSSTYRELSE": "202100-4508",
    "STATENS JORDBRUKSVERK": "202100-4151",
    "STATENS JÄRNVÄGAR": "202100-0787",
    "STATENS KONSTRÅD": "202100-1033",
    "STATENS KULTURRÅD": "202100-1280",
    "STATENS MARITIMA OCH TRANSPORTHISTORISKA MUSEER": "202100-1132",
    "STATENS MEDIERÅD": "202100-6396",
    "STATENS MUSEER FÖR VÄRLDSKULTUR": "202100-5075",
    "STATENS MUSIKVERK": "202100-3666",
    "STATENS NÄMND FÖR ARBETSTAGARES UPPFINNINGAR": "202100-5778",
    "STATENS RÄDDNINGSVERK": "202100-3914",
    "STATENS SERVICECENTER": "202100-6453",
    "STATENS SKOLINSPEKTION": "202100-6065",
    "STATENS SKOLVERK": "202100-4185",
    "STATENS STRÅLSKYDDSINSTITUT": "202100-0571",
    "STATENS TJÄNSTEPENSIONSVERK": "202100-0928",
    "STATENS VA-NÄMND": "202100-4029",
    "STATENS VETERINÄRMEDICINSKA ANSTALT": "202100-1868",
    "STATENS VÄG- OCH TRANSPORTFORSKNINGSINSTITUT": "202100-0704",
    "STATISTISKA CENTRALBYRÅN": "202100-0837",
    "STATSKONTORET": "202100-0852",
    "STOCKHOLMS KONSTNÄRLIGA HÖGSKOLA": "202100-6560",
    "STOCKHOLMS UNIVERSITET": "202100-3062",
    "STRÅLSÄKERHETSMYNDIGHETEN": "202100-5737",
    "STYRELSEN FÖR ACKREDITERING OCH TEKNISK KONTROLL": "202100-3815",
    "STYRELSEN FÖR INTERNATIONELLT UTVECKLINGSSAMARBETE": "202100-4789",
    "STYRELSEN FÖR PSYKOLOGISKT FÖRSVAR": "202100-0498",
    "SVENSKA INSTITUTET": "202100-4961",
    "SVENSKA INSTITUTET FÖR EUROPAPOLITISKA STUDIER": "202100-5331",
    "SVENSKA UNESCORÅDET": "202100-3831",
    "SVENSKT BIOGRAFISKT LEXIKON": "202100-1165",
    "SVERIGES DOMSTOLAR": "202100-2742",
    "SVERIGES GEOLOGISKA UNDERSÖKNING": "202100-2528",
    "SVERIGES LANTBRUKSUNIVERSITET": "202100-2817",
    "SVERIGES METEOROLOGISKA OCH HYDROLOGISKA INSTITUT": "202100-0696",
    "SÄKERHETS- OCH INTEGRITETSSKYDDSNÄMNDEN": "202100-5703",
    "SÄKERHETSPOLISEN": "202100-6594",
    "SÖDERTÖRNS HÖGSKOLA": "202100-4896",
    "TANDVÅRDS- OCH LÄKEMEDELSFÖRMÅNSVERKET": "202100-5364",
    "TILLVÄXTVERKET": "202100-6149",
    "TOTALFÖRSVARETS FORSKNINGSINSTITUT": "202100-5182",
    "TOTALFÖRSVARETS REKRYTERINGSMYNDIGHET": "202100-4771",
    "TRAFIKANALYS": "202100-6305",
    "TRAFIKVERKET": "202100-6297",
    "TRANSPORTSTYRELSEN": "202100-6099",
    "TULLVERKET": "202100-0969",
    "UMEÅ UNIVERSITET": "202100-2874",
    "UNIVERSITETSKANSLERSÄMBETET": "202100-6495",
    "UNIVERSITETS- OCH HÖGSKOLERÅDET": "202100-6487",
    "UPPHANDLINGSMYNDIGHETEN": "202100-6610",
    "UPPSALA UNIVERSITET": "202100-2932",
    "VALMYNDIGHETEN": "202100-5281",
    "VERKET FÖR FÖRVALTNINGSUTVECKLING": "202100-5596",
    "VERKET FÖR INNOVATIONSSYSTEM": "202100-5216",
    "VETENSKAPSRÅDET": "202100-5208",
    "ÅKLAGARMYNDIGHETEN": "202100-0084",
    "ÖREBRO UNIVERSITET": "202100-2924",
    "ÖVERKLAGANDENÄMNDEN FÖR ETIKPRÖVNING": "202100-5463",
    "ÖVERKLAGANDENÄMNDEN FÖR STUDIESTÖD": "202100-5273"
}
